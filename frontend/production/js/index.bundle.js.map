{"version":3,"sources":["webpack://trick-track/./source/js/util.js","webpack://trick-track/./source/js/matrix.js","webpack://trick-track/./source/js/cell.js","webpack://trick-track/./source/js/slider.js","webpack://trick-track/./source/js/bpm.js","webpack://trick-track/./source/js/player.js","webpack://trick-track/./source/js/add.js","webpack://trick-track/./source/js/controls.js","webpack://trick-track/./source/js/index.js"],"names":["sampleList","document","querySelector","sampleTemplate","content","renderStep","cellElement","createElement","classList","add","type","tabIndex","createCellsArray","i","slidesFirst","querySelectorAll","slidesSecond","cellsOfLane","push","apply","children","renderPlayedCells","cellsElements","lanes","forEach","lane","cells","cell","indexOf","j","played","style","borderColor","setCellPlayedColor","nextArrow","previousArrow","slideNumber","showSlide","n","slidesList","slides","length","remove","currentSlide","getElementById","sounds","newLanes","lines","map","sound","steps","clonedCell","Object","assign","obj","line","createLanes","checked","disabled","initialCells","newSample","cloneNode","textContent","replace","slice","append","stepsList","fragment","createDocumentFragment","fragmentOne","step","newStep","fillStep","cellsButtons","allCellsLists","createAllCellsArray","addEventListener","evt","target","background","cb","context","window","AudioContext","webkitAudioContext","playSound","audioData","playTime","source","createBufferSource","buffer","gain","createGain","connect","destination","start","urls","this","url","index","request","XMLHttpRequest","open","responseType","thisBuffer","onload","decodeAudioData","response","data","send","loadSound","createBuffer","getElementsByClassName","allSounds","btn","getSound","startTime","nextStepTime","currentStep","secondsPerBeat","bpm","isPlaying","scheduleSound","now","currentTime","playStepAtTime","nextStep","setTimeout","callback","key","isEscEvent","preventDefault"],"mappings":"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","file":"index.bundle.js","sourcesContent":["const PRIMARY_MOUSE_BUTTON = 0;\n\nconst isEscEvent = (evt) => {\n    return evt.key === ('Escape' || 'Esc');\n  };\n  \n  const isMouseLeftEvent = (evt) => {\n    return evt.button === PRIMARY_MOUSE_BUTTON;\n  }\n  \n  export {isEscEvent, isMouseLeftEvent}","import {setCellPlayedColor} from './cell.js';\n\nconst sequencer = document.querySelector('.sequencer__wrapper');\nconst sampleList = sequencer.querySelector('.sequencer__samples-list');\nconst sampleTemplate = document.querySelector('#matrix').content.querySelector('.sequencer__samples-item');\n\n// const createLine = (sound) => {\n//   const newSample = sampleTemplate.cloneNode(true);\n//   newSample.querySelector('.button').textContent = sound;\n//   sampleList.append(newSample);\n// }\n\nconst renderStep = () => {\n  const cellElement = document.createElement('button');\n  cellElement.classList.add('sequencer__cell');\n  cellElement.type = 'button';\n  cellElement.tabIndex = 0;\n\n  return cellElement;\n}\n\nconst fillStep = (stepsList, steps) => {\n   \n   const fragment = document.createDocumentFragment();\n   const fragmentOne = document.createDocumentFragment();\n\n   steps.slice(0, 16).forEach((step) => {\n    \n    const newStep = renderStep();\n  \n    fragment.append(newStep);\n    });\n\n    steps.slice(16, 32).forEach((step) => {\n      const newStep = renderStep();\n      fragmentOne.append(newStep);\n      });\n  \n    stepsList[0].append(fragment);\n    stepsList[1].append(fragmentOne);\n};\n  \n  \nconst generateMatrixLane = (lane) => {\n  const{line, cells} = lane\n  const newSample = sampleTemplate.cloneNode(true);\n  newSample.querySelector('.button').textContent = line.replace(/^.*[\\\\\\/]/, '').slice(0, -4);\n  sampleList.append(newSample);\n\n  const stepsList = newSample.querySelectorAll('.sequencer__step-list');\n  fillStep(stepsList, cells); \n};\n\n\nconst generateMatrix = (lanes) => {\n    lanes.forEach((lane) => {\n    generateMatrixLane(lane);\n  })\n};\n\nconst createCellsArray = (i) => {\n  const slidesFirst = document.querySelectorAll('.slide-1');\n  const slidesSecond = document.querySelectorAll('.slide-2');\n  \n  const cellsOfLane = [];\n    cellsOfLane.push.apply(cellsOfLane, slidesFirst[i].children);\n    cellsOfLane.push.apply(cellsOfLane, slidesSecond[i].children);\n    return cellsOfLane;\n}\n\nconst createAllCellsArray = () => {\n  const allCellsLists = []\n  for (let i = 0; i < 3; i++) {\n    const cellsOfLane = createCellsArray(i);\n    allCellsLists.push(cellsOfLane);\n  }\n  return allCellsLists\n}\n\nconst addButtonCellHandler = (cellsElements, lanes, cb) => {\n  //const cellsButtonsArray = createAllCellsArray();\n  cellsElements.forEach((cellsOfLane) => {\n\n    cellsOfLane.forEach((cell) => cell.addEventListener('click', (evt) => {\n      const i = cellsElements.indexOf(cellsOfLane, 0);\n      const {cells} = lanes[i];\n      const cell = evt.target;\n      const j = cellsOfLane.indexOf(cell, 0);\n      cells[j].checked = cells[j].checked ? false : true; \n      cell.style.background = cb(cells[j]);\n    }))\n  })\n};\n\nconst renderPlayedCells = (cellsElements, lanes) => {\n\n  lanes.forEach((lane) => {\n    const {cells} = lane;\n    cells.forEach((cell) => {\n      const i = lanes.indexOf(lane);\n      const cellsOfLane = cellsElements[i];\n      const j = cells.indexOf(cell, 0);\n\n      if (cell.played != false) {\n        cellsOfLane[j].style.borderColor = setCellPlayedColor(cell);\n      }\n      \n    })\n  })\n}\n\n\n//создание новой дорожки\n\n  \n\n// const deleteLane = (lanes) => {\n  \n//   const before = lanes.slice(0, i);\n//   const after = lanes.slice(i, i + 1);\n//     const newArray = [...before, ...after];\n\n//     return {\n//       lanes: newArray,\n//     }\n//   })\n// };\n\n\n\n\n  \n  export {generateMatrix, createAllCellsArray, generateMatrixLane, addButtonCellHandler, renderPlayedCells}","\nconst initialCells = (steps) => {\n    let cells = [];\n   \n    for (let i = 0; i < steps; i++) {\n\n      const cell = {\n        played: false,\n        checked: false,\n        disabled: false\n      };\n\n      cells.push(cell);\n    }\n    \n    return cells;\n}\n\nconst createLanes = (sounds, cells) => {\n  const lines = []\n \n  sounds.map((sound) => {\n    const steps = [];\n\n    for (let i = 0; i < cells.length; i++) {\n      const clonedCell = Object.assign({}, cells[i]);\n      steps.push(clonedCell)\n    }\n    const obj = {line: sound, cells: steps}\n    lines.push(obj)\n  })\n  return lines\n}\n\nconst setCellCheckedColor = (cell) => {\n  const {checked} = cell;\n  switch(checked) {\n    case true:\n      return '#000000';\n    break;\n    case false:\n      return '#ffffff';\n    break;\n    default:\n      return '#ffffff';\n  }\n}\n\nconst setCellPlayedColor = (cell) => {\n  const {played} = cell;\n  switch(played) {\n    case true:\n      return \"#ff00ff\";\n    break;\n    case (!true): \n      return \"\"\n    case false:\n      return \"#ffffff\";\n    break;\n    default:\n      return \"#ffffff\";\n  }\n}\n\n\n\nexport {initialCells, createLanes, setCellCheckedColor, setCellPlayedColor}","const nextArrow = document.querySelector('.slider__arrow--next');\nconst previousArrow = document.querySelector('.slider__arrow--prev');\nlet slideNumber = 1;\n\n \n//  class slider {\n      \n//   constructor(selector) {  \n//     this.loop = false;\n//     this.autoplay = false;\n//     this.slide = selector;\n//     this.interval = 5000;\n\nconst showSlide = (n) => {\n  const slidesLists = document.querySelectorAll('.slider-tracker');\n\n  slidesLists.forEach((slidesList) => {\n      const slides = slidesList.children\n\n      let i;\n      if (n > slides.length) {\n        slideNumber = 1;\n      }\n      if (n < 1) {\n        slideNumber = slides.length;\n      }\n      for (i = 0; i < slides.length; i++) {\n        slides[i].classList.remove(\"current-slide\");\n      }\n\n      slides[slideNumber-1].classList.add(\"current-slide\");\n    });\n    }\n\nconst onNextArrowClick = () => {\n  showSlide(slideNumber += 1);\n}\n\nconst onPreviousArrowClick = () => {\n  showSlide(slideNumber -= 1);\n}\nfunction currentSlide (n) {\n  showSlide(slideNumber = n);\n}\n\n\nconst addArrowsHandlers = () => {\n  nextArrow.addEventListener('click', onNextArrowClick);\n  previousArrow.addEventListener('click', onPreviousArrowClick);\n}\n\nexport {addArrowsHandlers, currentSlide}\n\n","const bpmControl = document.querySelector('#bpm');\n\n\nconst addBpmInputHandler = (callback) => {\n  let tempo\n    bpmControl.addEventListener('change', function() {\n    tempo = this.value;\n    callback(tempo)\n  });\n  \n};\n\nconst setTempo = (tempo) => {\n    //const tempo = bpmControl.value;\n    const tic = (60 / tempo) / 4;\n    return tic;  \n  }\n\n\n\nexport {addBpmInputHandler, setTempo};\n","const player = document.querySelectorAll('.player')\nconst playButton = document.getElementById('play');\nconst stopButton = document.getElementById('stop');\n\nconst playProject = (cb) => {\n    //isPlaying = true;\n    cb();\n}\n\nconst stopPlayProject = (cb) => {\n    //isPlaying = false;\n    cb();\n}\n\nconst addButtonPlayHandler = (callback, cb) => {\n    playButton.addEventListener('click', (callback));\n    stopButton.removeEventListener('click', (cb))\n}\n\nconst addButtonStopHandler = (cb, callback) => {\n    stopButton.addEventListener('click', (cb));\n    playButton.removeEventListener('click', callback)\n\n}\n\nexport {addButtonPlayHandler, addButtonStopHandler}","import {generateMatrixLane} from './matrix.js';\n\nconst inputAdd = document.getElementById('.#sample');\n\nconst FILE_TYPES = ['mp3', 'wav'];\n\nconst uploadFile = (evt, cb) => {\n\n    const sound = evt.files;\n    const fileName = sound.url.toLowerCase();\n  \n    const matches = FILE_TYPES.some((it) => {\n      return fileName.endsWith(it);\n    });\n  \n    if (matches) {\n      const reader = new FileReader();\n      reader.addEventListener('load', cb)\n      reader.readAsDataURL(sound);\n    }\n  };\n  \nconst uploadSound = () => {\n  uploadFile(inputAdd, generateMatrixLane)\n}\n\nconst addInpytAddHandler = () => {\n  inputAdd.addEventListener('click', uploadSound)\n};\n\nexport {addInpytAddHandler}","const volumeControls = document.querySelectorAll('[data-action=\"volume\"]');\nconst pannerControls = document.querySelectorAll('[data-action=\"panner\"]');\n\nconst am = (buffer, audioData) => {\n    volumeControls.forEach((volumeControl) => {\n        console.log(volumeControl)\n        volumeControl.addEventListener('input', () => {\n            const j = volumeControls.indexOf(volumeControl, 0)\n            const i = [...buffer.urls].indexOf(audioData, 0)\n            if (j === i) {\n                return volumeControl.value;\n            } \n        })\n    });\n}\n\n\n\n\n// volumeControl.addEventListener('input', function() {\n//     \n// \tgainNode.gain.value = this.value;\n// }, false);\n\n// // panning\n// const pannerOptions = {pan: 0};\n// const panner = new StereoPannerNode(context, pannerOptions);\n\n\n// pannerControl.addEventListener('input', function() {\n// \tpanner.pan.value = this.value;\t\n// }, false);\n export {am}; ","import {isEscEvent} from './util.js';\nimport {initialCells, setCellCheckedColor, createLanes, setCellPlayedColor} from './cell.js';\nimport {addButtonCellHandler, generateMatrix, createAllCellsArray, renderPlayedCells} from './matrix.js';\nimport {addArrowsHandlers, currentSlide} from './slider.js';\nimport {addBpmInputHandler, setTempo} from './bpm.js';\nimport {addButtonPlayHandler, addButtonStopHandler} from './player.js';\nimport {addInpytAddHandler} from './add.js';\nimport {am} from './controls.js';\n\n//import {debounce} from 'lodash';\n\nconst DEBOUNCE_TIME = 1000;\n\n\nlet sounds = ['./samples/bdsh.wav', \n                './samples/boom.wav', \n                './samples/tsk.wav',\n              ];\n\nconst STEPS = 32;\nconst activeStep = 30; \n\nconst newCells = initialCells(STEPS);\nconst newLanes = createLanes(sounds, newCells); //дорожки\ngenerateMatrix(newLanes); // отрисовка дорожек\n\nconst cellsButtons = createAllCellsArray();\n\naddButtonCellHandler(cellsButtons, newLanes, setCellCheckedColor)\n\naddArrowsHandlers(); //стрелки слайдера\n\n\n\n\n\n\n\n// addFilterHandlers(\n//   debounce(renderOffersPin, DEBOUNCE_TIME));\n// })\n\n\n\n////Bufer////////////////////////////////////////////////////////\n\nlet context = new (window.AudioContext || window.webkitAudioContext)();\n\nclass Buffer {\n  \n  constructor(context, urls) {  \n    this.context = context;\n    this.urls = urls;\n    this.buffer = [];\n  }\n  \n  loadSound(url, index) {\n    let request = new XMLHttpRequest();\n    request.open('get', url, true);\n    request.responseType = 'arraybuffer';\n    let thisBuffer = this;\n    request.onload = function() {\n    \n      thisBuffer.context.decodeAudioData(request.response, function(data) {\n          thisBuffer.buffer[index] = data;\n      });\n          \n     };\n    request.send();\n  };\n  \n  createBuffer() {\n    this.urls.forEach((url, index) => {\n      this.loadSound(url, index);\n  \n    })\n  }\n\n getSound(index) {\n    return this.buffer[index];\n  }\n\n}\n\n\n\n\nconst playSound = (audioData, playTime) => {\n\n  const source = context.createBufferSource(); \n  source.buffer = audioData;\n  const gain = context.createGain();\n\n  source.connect(gain).connect(context.destination);\n \n    source.start(playTime);\n}\n\n\nconst buffer = new Buffer(context, sounds);\n\nbuffer.createBuffer();\n\n//////////////////////////////////////////////////\n\n\nlet button = document.getElementsByClassName('button');\nvar allSounds = [];\n  allSounds.push.apply(allSounds, button);\n\n\n\nconst onButtonPlaySound = () => {\n\n  allSounds.forEach((btn) => btn.addEventListener('click', (evt) => {\n      btn = evt.target;\n      const i = allSounds.indexOf(btn, 0);\n\n    playSound(buffer.getSound(i), 0) \n\n}))\n}\n\nonButtonPlaySound();\n\n\n\n//Sequencer\n\nlet startTime = 0;\nlet nextStepTime = 0.0;\nlet currentStep = 0;\nlet secondsPerBeat = 60 / bpm ;    \nlet isPlaying = false;\n\n\nfunction scheduleSound() {\n  let now = context.currentTime;\n  now -= startTime\n \n\n  while (nextStepTime < now + 0.2 ) {\n    \n    let pt = nextStepTime + startTime;\n    playStepAtTime(newLanes, pt, renderPlayedCells);\n    \n    nextStep(newLanes, currentSlide);\n  }\n    const ti = setTimeout(scheduleSound, 0);\n}\n\n\n\nfunction nextStep(lanes, callback) {\n  currentStep++;\n\n  lanes.forEach((lane) => {\n\n    const {cells} = lane;\n    cells.forEach((cell) => {\n      const currentCell = lane.cells[currentStep - 1];\n   \n    if (cell = currentCell) {\n      cell.played = true; \n    }\n    else {\n      cell.played = false\n    };\n\n   });\n  });\n\n  currentStep > 16 ? callback(2)  : callback(1);\n  \n  \n  if (currentStep === activeStep) {\n    currentStep = 0;\n  }\n  \n  nextStepTime += secondsPerBeat / 4;\n}\n\n\n\nfunction playStepAtTime(lanes, playTime, callback) {\n \n    for(let i = 0; i < lanes.length; i++) {\n        const lane = lanes[i];\n        if (lane.cells[currentStep].checked != false) {\n          playSound(buffer.getSound(i), playTime);\n        }\n    }\n    callback(cellsButtons, newLanes);\n} \n\n\n\nfunction play() {\n  isPlaying = true;\n  currentStep = currentStep;\n  nextStepTime = 0;\n  startTime = context.currentTime + 0.005;\n  scheduleSound();\n\n}\n\n\n\n\n// function stop() {\n//   isPlaying = false;\n//   scheduleSound()  \n//   console.log('stop')\n//   console.log(isPlaying)\n// }\n\n\n\n// addButtonPlayHandler(play, stop);\n// addButtonStopHandler(stop, play)\n\n\n\n  \n\n// const loop = () => {\n//   let spb = (60/120);\n//   let frames = 0;\n\n//    let currentC = 0;\n//    let lastStep = -1;\n\n//   if(!isPlaying) {\n//     frames++;\n\n//     let seconds = 60/frames;\n//     let beatTime = spb/seconds%activeStep;\n\n\n//     lastStep = currentC;\n//     currentC = Math.floor(beatTime*4);\n\n\n//     if(lastStep != currentC) {\n     \n      \n//      //for (let i = 0; i < activeStep; i++) {\n//       if(lastStep === i) {\n//         now = 0;\n//         playSound(buffer.getSound(1))\n//         playSound(buffer.getSound(2))\n//       }\n//     } \n//   }\n\n// }\n//   requestAnimationFrame(loop)\n\n// }\n\n\n\ndocument.addEventListener('keydown', (evt) => {\n  \n    if (isEscEvent(evt)) {\n      evt.preventDefault();\n      isPlaying = !isPlaying\n      play()\n    }\n});\n\n\n\n"],"sourceRoot":""}